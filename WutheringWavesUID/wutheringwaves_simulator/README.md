# 鸣潮模拟抽卡模块

## 功能简介

这是一个完全模拟鸣潮抽卡系统的模块，支持角色池和武器池的十连抽和单抽功能。

## 主要特性

- ✅ **真实概率模拟**: 完全按照官方概率设计
- ✅ **保底机制**: 支持大小保底系统
- ✅ **用户数据记录**: 记录每个用户的抽卡历史
- ✅ **精美图片生成**: 生成类似官方的抽卡结果图
- ✅ **多池子支持**: 支持角色池和武器池
- ✅ **配置化设计**: 可通过YAML文件轻松修改池子内容

## 指令列表

| 指令 | 功能 | 示例 |
|------|------|------|
| `鸣潮十连` | 角色十连抽卡 | `鸣潮十连` |
| `鸣潮武器十连` | 武器十连抽卡 | `鸣潮武器十连` |
| `鸣潮单抽` | 角色单抽 | `鸣潮单抽` |
| `鸣潮武器单抽` | 武器单抽 | `鸣潮武器单抽` |
| `模拟抽卡帮助` | 查看帮助 | `模拟抽卡帮助` |

## 概率设计

### 角色池
- **五星**: 0.6% 基础概率，73抽后开始递增，90抽保底
- **四星**: 5.1% 基础概率，9抽保底
- **三星**: 保底

### 武器池
- **五星**: 0.8% 基础概率，63抽后开始递增，80抽保底
- **四星**: 6.6% 基础概率，9抽保底
- **三星**: 保底

## 文件结构

```
wutheringwaves_simulator/
├── __init__.py              # 主入口文件
├── simulator_logic.py       # 抽卡逻辑核心
├── draw_simulator_card.py   # 图片生成
├── config/                  # 配置文件
│   ├── role.yaml           # 角色池配置
│   └── weapon.yaml         # 武器池配置
└── README.md               # 说明文件
```

## 配置说明

### 角色池配置 (role.yaml)
```yaml
pool_name: "角色精准调谐"
five_star:
  basic: 0.006        # 基础概率
  increase: 0.06      # 递增概率
  other: 0.5          # 歪的概率
  up_pool:            # UP角色池
    - name: "长离"
      id: 1410
  other_pool:         # 常驻角色池
    - name: "渊武"
      id: 1608
```

### 武器池配置 (weapon.yaml)
```yaml
pool_name: "武器精准调谐"
five_star:
  basic: 0.008        # 基础概率
  increase: 0.08      # 递增概率
  other: 0.25         # 歪的概率
  up_pool:            # UP武器池
    - name: "长离专武"
      id: 21020011
```

## 数据存储

用户抽卡数据存储在Redis中，键值格式：
- `waves:simulator:role:{user_id}` - 角色池数据
- `waves:simulator:weapon:{user_id}` - 武器池数据

存储内容：
```json
{
  "five_star_time": 0,      // 距离五星保底的抽数
  "five_star_other": true,  // 是否可能歪
  "four_star_time": 0,      // 距离四星保底的抽数
  "four_star_other": true   // 是否可能歪
}
```

## 技术实现

### 核心算法
1. **概率计算**: 根据抽数计算当前概率
2. **保底判断**: 检查是否触发保底
3. **UP判断**: 根据历史记录判断是否歪
4. **结果生成**: 从对应池子中随机选择

### 图片生成
- 使用PIL库生成抽卡结果图
- 支持角色头像和武器图片
- 显示星级、名称、UP标记
- 包含用户信息和保底进度

## 扩展功能

### 添加新角色
1. 在`config/role.yaml`中添加角色信息
2. 确保角色ID在系统中存在
3. 添加对应的头像资源

### 修改概率
1. 编辑配置文件中的概率参数
2. 重启机器人使配置生效

### 自定义背景
1. 替换`TEXT_PATH`中的背景图片
2. 修改`draw_simulator_card.py`中的图片路径

## 注意事项

1. **数据持久化**: 用户数据存储在Redis中，重启后数据会保留
2. **资源依赖**: 需要角色头像和武器图片资源
3. **配置更新**: 修改配置文件后需要重启机器人
4. **概率准确性**: 概率完全按照官方设定，确保真实性

## 更新日志

### v1.0.0
- 初始版本发布
- 支持角色池和武器池
- 实现完整的保底机制
- 生成精美的抽卡结果图

