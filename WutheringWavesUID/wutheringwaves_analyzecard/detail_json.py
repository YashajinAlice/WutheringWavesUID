# id2name
DETAIL = {
    "1304": {"name": "今汐", "fetterDetail": "浮星祛暗"},
    "1604": {"sex": "女", "name": "漂泊者·湮灭", "fetterDetail": "沉日劫明"},
    "1303": {"name": "渊武", "fetterDetail": "高天共奏之曲"},
    "1105": {"name": "折枝", "fetterDetail": "高天共奏之曲"},
    "1505": {"name": "守岸人", "fetterDetail": "隐世回光"},
    "1605": {"sex": "男", "name": "漂泊者·湮灭", "fetterDetail": "沉日劫明"},
    "1205": {"name": "长离", "fetterDetail": "熔山裂谷"},
    "1506": {"name": "菲比", "fetterDetail": "此间永驻之光"},
    "1104": {"name": "凌阳", "fetterDetail": "凝夜白霜"},
    "1203": {"name": "安可", "fetterDetail": "熔山裂谷"},
    "1302": {"name": "吟霖", "fetterDetail": "高天共奏之曲"},
    "1502": {"sex": "女", "name": "漂泊者·衍射", "fetterDetail": "此间永驻之光"},
    "1405": {"name": "鉴心", "fetterDetail": "啸谷长风"},
    "1103": {"name": "白芷", "fetterDetail": "隐世回光"},
    "1106": {"name": "釉瑚", "fetterDetail": "隐世回光"},
    "1202": {"name": "炽霞", "fetterDetail": "熔山裂谷"},
    "1503": {"name": "维里奈", "fetterDetail": "隐世回光"},
    "1606": {"name": "洛可可", "fetterDetail": "幽夜隐匿之帷"},
    "1102": {"name": "散华", "fetterDetail": "轻云出月"},
    "1301": {"name": "卡卡罗", "fetterDetail": "彻空冥雷"},
    "1403": {"name": "秋水", "fetterDetail": "啸谷长风"},
    "1601": {"name": "桃祈", "fetterDetail": "轻云出月"},
    "1602": {"name": "丹瑾", "fetterDetail": "沉日劫明"},
    "1305": {"name": "相里要", "fetterDetail": "彻空冥雷"},
    "1204": {"name": "莫特斐", "fetterDetail": "高天共奏之曲"},
    "1107": {"name": "珂莱塔", "fetterDetail": "凌冽决断之心"},
    "1504": {"name": "灯灯", "fetterDetail": "彻空冥雷"},
    "1603": {"name": "椿", "fetterDetail": "沉日劫明"},
    "1501": {"sex": "男", "name": "漂泊者·衍射", "fetterDetail": "此间永驻之光"},
    "1404": {"name": "忌炎", "fetterDetail": "啸谷长风"},
    "1402": {"name": "秧秧", "fetterDetail": "啸谷长风"},
    "1206": {"name": "布兰特", "fetterDetail": "无惧浪涛之勇"},
    "1408": {"sex": "女", "name": "漂泊者·气动", "fetterDetail": "流云逝尽之空"},
    "1406": {"sex": "男", "name": "漂泊者·气动", "fetterDetail": "流云逝尽之空"},
    "1607": {"name": "坎特蕾拉", "fetterDetail": "幽夜隐匿之帷"},
    "1507": {"name": "赞妮", "fetterDetail": "此间永驻之光"},
    "1407": {"name": "夏空", "fetterDetail": "流云逝尽之空"},
    "1409": {"name": "卡提希娅", "fetterDetail": "愿戴荣光之旅"},
    "1207": {"name": "露帕", "fetterDetail": "奔狼燎原之焰"},
    "1608": {"name": "弗洛洛", "fetterDetail": {"失序彼岸之梦": 3, "幽夜隐匿之帷": 2}},
    "1306": {"name": "奥古斯塔", "fetterDetail": "荣斗铸锋之冠"},
}

# resource/intensity_echo_detail.json
# 4cost
SONATA_COST_4_ID = {
    "凝夜白霜": [6000044, 6000085],
    "熔山裂谷": [6000091, 390080007, 6000085],
    "彻空冥雷": [390080003, 6000039, 6000088, 6000089, 6000085],
    "啸谷长风": [6000086, 6000043, 6000085],
    "浮星祛暗": [6000059, 6000045, 6000085],
    "沉日劫明": [6000090, 6000053, 6000042, 6000085],
    "隐世回光": [6000060, 390080005],
    "轻云出月": [6000052, 390080005],
    "不绝余音": [6000048],
    "凌冽决断之心": [6000083, 6000105],
    "高天共奏之曲": [6000085, 6000089, 6000105],
    "幽夜隐匿之帷": [6000082, 6000087],
    "此间永驻之光": [6000092],
    "无惧浪涛之勇": [6000084],
    "流云逝尽之空": [6000106, 6000113],
    "愿戴荣光之旅": [6000106, 6000113],
    "奔狼燎原之焰": [6000114],
    "失序彼岸之梦": [6000115, 6000116],
    "荣斗铸锋之冠": [6000121, 6000160],
}

# 3cost
SONATA_COST_3_ID = {
    "凝夜白霜": [],
    "熔山裂谷": [],
    "彻空冥雷": [],
    "啸谷长风": [],
    "浮星祛暗": [],
    "沉日劫明": [],
    "隐世回光": [],
    "轻云出月": [],
    "不绝余音": [],
    "凌冽决断之心": [6000076],
    "高天共奏之曲": [6000076],
    "幽夜隐匿之帷": [],
    "此间永驻之光": [6000104],
    "无惧浪涛之勇": [],
    "流云逝尽之空": [6000104],
    "愿戴荣光之旅": [6000104, 6000112],
    "奔狼燎原之焰": [6000112],
    "失序彼岸之梦": [],
    "荣斗铸锋之冠": [],
}

# 1cost
SONATA_COST_1_ID = {
    "凝夜白霜": [],
    "熔山裂谷": [],
    "彻空冥雷": [],
    "啸谷长风": [],
    "浮星祛暗": [],
    "沉日劫明": [],
    "隐世回光": [],
    "轻云出月": [],
    "不绝余音": [],
    "凌冽决断之心": [],
    "高天共奏之曲": [],
    "幽夜隐匿之帷": [],
    "此间永驻之光": [],
    "无惧浪涛之勇": [],
    "流云逝尽之空": [],
    "愿戴荣光之旅": [6000100, 6000109, 6000110],
    "奔狼燎原之焰": [],
    "失序彼岸之梦": [],
    "荣斗铸锋之冠": [],
}


# 从limit.json提取完整的声骸配置
def load_complete_sonata_config():
    """从limit.json加载完整的套装声骸配置"""
    import json
    from pathlib import Path

    limit_path = Path(__file__).parent.parent / "utils/map/limit.json"

    try:
        with open(limit_path, "r", encoding="utf-8") as f:
            limit_data = json.load(f)

        # 初始化配置字典
        cost_4_config = {}
        cost_3_config = {}
        cost_1_config = {}

        # 遍历所有套装配置
        for lib in limit_data.get("sonataLib", []):
            for fetter in lib.get("fetterList", []):
                sonata_name = fetter["fetterDetailName"]

                # 初始化列表
                if sonata_name not in cost_4_config:
                    cost_4_config[sonata_name] = []
                if sonata_name not in cost_3_config:
                    cost_3_config[sonata_name] = []
                if sonata_name not in cost_1_config:
                    cost_1_config[sonata_name] = []

                # 按cost分类声骸ID
                for phantom in fetter.get("equipPhantomList", []):
                    phantom_id = phantom["phantomId"]
                    cost = phantom["cost"]

                    if cost == 4:
                        if phantom_id not in cost_4_config[sonata_name]:
                            cost_4_config[sonata_name].append(phantom_id)
                    elif cost == 3:
                        if phantom_id not in cost_3_config[sonata_name]:
                            cost_3_config[sonata_name].append(phantom_id)
                    elif cost == 1:
                        if phantom_id not in cost_1_config[sonata_name]:
                            cost_1_config[sonata_name].append(phantom_id)

        return cost_4_config, cost_3_config, cost_1_config

    except Exception as e:
        print(f"加载limit.json失败: {e}")
        return {}, {}, {}


# 加载完整配置
COMPLETE_COST_4_ID, COMPLETE_COST_3_ID, COMPLETE_COST_1_ID = (
    load_complete_sonata_config()
)


# 更新现有配置（保留原有配置，补充缺失的）
def update_sonata_config():
    """更新套装配置，补充缺失的3cost和1cost数据"""
    global SONATA_COST_4_ID, SONATA_COST_3_ID, SONATA_COST_1_ID

    # 补充3cost配置
    for sonata_name, phantom_ids in COMPLETE_COST_3_ID.items():
        if sonata_name in SONATA_COST_3_ID:
            # 合并现有配置和完整配置
            existing_ids = set(SONATA_COST_3_ID[sonata_name])
            new_ids = [pid for pid in phantom_ids if pid not in existing_ids]
            SONATA_COST_3_ID[sonata_name].extend(new_ids)
        else:
            SONATA_COST_3_ID[sonata_name] = phantom_ids

    # 补充1cost配置
    for sonata_name, phantom_ids in COMPLETE_COST_1_ID.items():
        if sonata_name in SONATA_COST_1_ID:
            # 合并现有配置和完整配置
            existing_ids = set(SONATA_COST_1_ID[sonata_name])
            new_ids = [pid for pid in phantom_ids if pid not in existing_ids]
            SONATA_COST_1_ID[sonata_name].extend(new_ids)
        else:
            SONATA_COST_1_ID[sonata_name] = phantom_ids


# 执行配置更新
update_sonata_config()
